{% extends "layout.html" %}

{% block content %}
<br />
<br />
<head>
    <title>Geocoding Service</title>
    <!--<meta name="viewport" content="initial-scale=1.0, user-scalable=no">-->
    <style>
         /* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
         #map {
             height: 425px;
         }
         /* Optional: Makes the sample page fill the window. */
         html, body {
             height: 100%;
             margin: 0;
             padding: 0;
         }

         #floating-panel {
             position: absolute;
             top: 100px;
             left: 25%;
             z-index: 5;
             background-color: #fff;
             padding: 5px;
             border: 1px solid #999;
             text-align: center;
             font-family: 'Roboto','sans-serif';
             line-height: 30px;
             padding-left: 10px;
         }
    </style>
</head>
<body>
    <div id="floating-panel">
        <input id="address" type="text" value="Fayetteville, NC">
        <input id="submit" type="button" value="Geocode">
    </div>
    <div id="map"></div>
    <script>
        function initMap() {
           var map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 35.052666, lng: -78.878357 },
                zoom: 8
            });
            var geocoder = new google.maps.Geocoder();

            document.getElementById('submit').addEventListener('click', function () {
                geocodeAddress(geocoder, map);
            });
        }

        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('address').value;
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                    });
                    var loc1 = results[0];
                    var county, state;
                    $.each(loc1, function (k1, v1) {
                        if (k1 == "address_components") {
                            for (var i = 0; i < v1.length; i++) {
                                for (k2 in v1[i]) {
                                    if (k2 == "types") {
                                        var types = v1[i][k2];
                                        if (types[0] == "administrative_area_level_2") {
                                            county = v1[i].long_name;
                                            //alert ("county: " + county);
                                        }
                                        if (types[0] == "administrative_area_level_1") {
                                            state = v1[i].long_name;
                                            //alert ("state: " + state);
                                        }
                                    }

                                }

                            }

                        }

                    });

                    if (county == "" || county == "undefined" || county == null) {
                        alert ("Could not locate County. Please enter an exact street address.");
                    }

                    var county = String(county) + ", " + String(state)

                    //shows the entire object data
                    //var myJSON = JSON.stringify(results);
                    //document.getElementById("County").value = myJSON;
                   
                    //var loc = results[0].address_components[1].short_name
                    //var loc2 = results[0].address_components[2].long_name
                    //var county = String(loc) + ", "+ String(loc2)

                    document.getElementById('County').value = county;
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGT0avpEh98zEV2TcnRn1x-4V8b3s71Kc&library=places&callback=initMap"
            async defer></script>
</body>

<section id="GLAPS">

    <div class="row section-head">
        <div class="twelve columns">

            <h1>{{title}}<span>.</span></h1>
            <h2>{{message}}</h2>
            <hr />
        </div>
    </div> <!-- end section-head -->

    <div class="row">

        <div id="GLAPS" class="six columns tab-whole left">

            <!-- form -->
            <form name="GLAPS" id="GLAPS" method="post" action="">
                <fieldset>
                    <div>
                        <h3>{{countyError}}</h3>
                        <input name="County" type="text" readonly id="County" placeholder="County" value="" />
                    </div>
                    <div>
                        <h3>{{valueError}}</h3>
                        <script>
                            function isNumber(input) {
                                var regex = /[^0-9]/gi;
                                input.value = input.value.replace(regex, '');
                            }
                        </script>
                        <input name="HomeVal" type="text" id="HomeVal" placeholder="Current Home Value" value="" onkeyup="isNumber(this)"/>
                    </div>
                    <div>
                        <button class="submitform">Submit</button>
                        <div id="submit-loader">
                            <div class="text-loader">Sending...</div>
                            <div class="s-loader">
                                <div class="bounce1"></div>
                                <div class="bounce2"></div>
                                <div class="bounce3"></div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form> <!-- Form End -->
            <!-- contact-warning -->
            <div id="message-warning"></div>
            <!-- contact-success -->
            <div id="message-success">
                <i class="icon-ok"></i>Your results are: {{message}}<br />
            </div>
        </div>
    </div> <!-- end row -->
</section>

<!--This page is for show the forecast data from the GLAPS system-->
{% endblock %}
